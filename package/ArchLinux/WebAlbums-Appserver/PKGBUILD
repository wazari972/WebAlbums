#!/bin/sh
# Maintainer: Kevin Pouget <webalbums-archlinux@0x972.info>

_package_switch=appserver

case ${_package_switch} in
    appserver)
        _description="Tomee Application Appserver"
        depends=('jre7-openjdk')
        _make_target=prep_appserver
        ;;
    webapp)
        msg "not yet"
        exit -1;
        ;;
    wfs)
        msg "not yet"
        exit -1;
        ;;
    all)
        msg "not yet"
        exit -1;
        ;;
    *)
        msg "Unknown package to build ($_package_switch), exiting ..."
        exit -1
        ;;
esac
pkgname=webalbums-$_package_switch-git
pkgrel=0
pkgver=1
pkgdesc="Free webbased photo manager -- $_package_switch"
arch=('any')
url="https://github.com/wazari972/WebAlbums"
license=('GPL')
makedepends=('git')

md5sums=() #generate with 'makepkg -g'

_gitroot=https://github.com/wazari972/WebAlbums
_gitname=webalbums-git

_localgit=/home/kevin/WebAlbums

build() {
    cd "$srcdir"
    msg "Connecting to git server...."
    
    if [[ -d "$_gitname" ]]; then
        msg "Pulling from git origin repository ..."
        cd "$_gitname" && git pull origin
        msg "The local files are updated."
    else
        msg "Cloning git origin repository ..."
        git clone "$_gitroot" "$_gitname"
    fi
    
    msg "Git checkout done (or server timeout)"
    msg "Starting build..."
    
    make -f $srcdir/$_gitname/package/Makefile BUILD_DIRNAME=$srcdir/build $_make_target
    msg "Build done"
}

package() {
    msg "Preparing package archive ... $srcdir/build $pkgdir/"
    cp -r $srcdir/build/* $pkgdir/
}
